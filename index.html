<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Coin Price Expectation</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container mt-5">
      <div class="row">
        <div id="left-side" class="col-md-7">
          <h1 class="event-card-title text-center mb-5">
            내일의 비트코인 가격은 어떻게 될까!
          </h1>
          <p class="event-card-description text-center mb-5">
            "한 번의 예측으로 비트코인을 받아가세요! 당신이 예측한 날의 코인
            가격이 가장 가깝다면, 상위 3분께 소정의 비트코인을 선물로 드립니다
            😄"
          </p>
          <h2 class="event-card-price text-center">현재 가격: $27,970</h2>
          <span class="event-card-warning">
            * 현재가는 CryptoCompare 기준이며, 참고용으로 제공됩니다. 실제
            이벤트 참여 시 기준 가격은 바이낸스 BTC/USDT 기준으로 산정됩니다.
          </span>
          <div class="tradingview-widget-container">
            <div id="tradingview_91d31"></div>
          </div>
        </div>
        <div id="right-side" class="col-md-5">
          <div class="mt-5">
            <h2 class="text-center mb-5">현재까지 참여 현황</h2>
            <div class="card-field row">
              <div class="col-md-4">
                <h5 class="card-title">현재 순위</h5>
              </div>
              <div class="col-md-4">
                <h5 class="card-title">예상 가격</h5>
              </div>
              <div class="col-md-4">
                <h5 class="card-title">휴대폰 뒤 4자리</h5>
              </div>
            </div>
            <div id="current-status"></div>
          </div>
          <div class="mt-5">
            <h2 class="text-center mb-3">참여하기</h2>
            <form
              action="https://script.google.com/macros/s/AKfycbwpm21kjEFxjCoGLr91PouK4YUlnpudbGnBvsvMWQq3J-7KjAeP-82J2VkCwcy0btNl/exec?function=doPost"
              method="post"
            >
              <div class="form-group">
                <label for="coin-name">이름</label>
                <input
                  type="text"
                  class="form-control"
                  id="coin-name"
                  placeholder="예상 가격"
                />
              </div>
              <div class="form-group">
                <label for="coin-price">코인 가격</label>
                <input
                  type="number"
                  class="form-control"
                  id="coin-price"
                  placeholder="코인 가격을 입력하세요..."
                />
              </div>
              <div class="form-group">
                <label for="coin-expectation">휴대폰 번호</label>
                <input
                  type="number"
                  class="form-control"
                  id="coin-expectation"
                  placeholder="휴대폰 번호를 입력하세요..."
                />
              </div>
              <button type="submit" class="btn btn-primary">제출</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- jQuery 파일 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- 부트스트랩 JS 파일 -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
      // jQuery
      $("form").submit(function (event) {
        event.preventDefault();
        const coinName = $("#coin-name").val();
        const coinPrice = $("#coin-price").val();
        const coinExpectation = $("#coin-expectation").val();
        $("#result-coin-name").text(coinName);
        $("#result-coin-price").text(coinPrice);
        $("#result-coin-expectation").text(coinExpectation);
      });
    </script>
    <script
      type="text/javascript"
      src="https://s3.tradingview.com/tv.js"
    ></script>
    <script type="text/javascript">
      let main = document.querySelector("#left-side");
      let width = main.offsetWidth - 20;
      let height = main.offsetHeight - 20;

      new TradingView.widget({
        width: width,
        height: height,
        symbol: "BINANCE:BTCUSDT",
        interval: "5",
        timezone: "Etc/UTC",
        theme: "dark",
        style: "1",
        locale: "en",
        toolbar_bg: "#f1f3f6",
        enable_publishing: false,
        allow_symbol_change: true,
        container_id: "tradingview_91d31",
      });
    </script>
    <script>
      $(document).ready(function () {
        const ajaxSettings = {
          url: "https://script.google.com/macros/s/AKfycbwpm21kjEFxjCoGLr91PouK4YUlnpudbGnBvsvMWQq3J-7KjAeP-82J2VkCwcy0btNl/exec",
          success: (data) => {
            const container = document.querySelector("#current-status");
            data.forEach((result) => {
              const card = `
              <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                    <p class="card-text" id="result-rank">${result.rank}</p>
                    </div>
                    <div class="col-md-4">
                    <p class="card-text" id="result-rank">${result.price}</p>
                    </div>
                    <div class="col-md-4">
                    <p class="card-text" id="result-rank">${result.phone.slice(
                      -4
                    )}</p>
                    </div>
                    </div>
                </div>
                </div>`;

              container.insertAdjacentHTML("beforeend", card);
            });
          },
          error: () => {
            alert("추천에 실패했습니다. 잠시 후에 다시 시도해주세요.");
          },
        };

        $.ajax({ ...ajaxSettings, method: "GET", data: { function: "doGet" } });
      });

      function updateCards(data) {
        console.log(data);
      }
    </script>
  </body>
</html>
